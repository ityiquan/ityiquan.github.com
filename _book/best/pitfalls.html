
<!DOCTYPE HTML>
<html lang="zh" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>常见问题 & 最佳事件 · 前端知识点总结</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="store.html" />
    
    
    <link rel="prev" href="../注意点--技巧.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="輸入並搜尋" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../MobX.html">
            
                <a href="../MobX.html">
            
                    
                    MobX
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    介绍
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../intro/overview.html">
            
                <a href="../intro/overview.html">
            
                    
                    MobX 要点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../intro/concepts.html">
            
                <a href="../intro/concepts.html">
            
                    
                    概念 & 原则
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../refguide/api.html">
            
                <a href="../refguide/api.html">
            
                    
                    API 概述
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../refguide/observable.html">
            
                <a href="../refguide/observable.html">
            
                    
                    observable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../refguide/observable-decorator.html">
            
                <a href="../refguide/observable-decorator.html">
            
                    
                    @observable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../refguide/computed-decorator.html">
            
                <a href="../refguide/computed-decorator.html">
            
                    
                    (@)computed
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../refguide/autorun.html">
            
                <a href="../refguide/autorun.html">
            
                    
                    autorun
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../refguide/observer-component.html">
            
                <a href="../refguide/observer-component.html">
            
                    
                    (@)observer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../refguide/action.html">
            
                <a href="../refguide/action.html">
            
                    
                    action
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    Observable 类型
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../refguide/object.html">
            
                <a href="../refguide/object.html">
            
                    
                    对象
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../refguide/array.html">
            
                <a href="../refguide/array.html">
            
                    
                    数组
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../refguide/map.html">
            
                <a href="../refguide/map.html">
            
                    
                    maps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../refguide/boxed.html">
            
                <a href="../refguide/boxed.html">
            
                    
                    boxed values
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="react.html">
            
                <a href="react.html">
            
                    
                    理解MobX是如何响应的
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="decorators.html">
            
                <a href="decorators.html">
            
                    
                    如何（不）使用装饰符
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../资料.html">
            
                <a href="../资料.html">
            
                    
                    资料
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../faq/blogs.html">
            
                <a href="../faq/blogs.html">
            
                    
                    教程，视频和博客
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../faq/related.html">
            
                <a href="../faq/related.html">
            
                    
                    相关项目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../faq/examples.html">
            
                <a href="../faq/examples.html">
            
                    
                    示例项目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../faq/boilerplates.html">
            
                <a href="../faq/boilerplates.html">
            
                    
                    样板
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../faq/faq.html">
            
                <a href="../faq/faq.html">
            
                    
                    常见问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../注意点--技巧.html">
            
                <a href="../注意点--技巧.html">
            
                    
                    注意点 & 技巧
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.9.1" data-path="pitfalls.html">
            
                <a href="pitfalls.html">
            
                    
                    常见问题 & 最佳事件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="store.html">
            
                <a href="store.html">
            
                    
                    定义 stores
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="actions.html">
            
                <a href="actions.html">
            
                    
                    创建（异步）actions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="react-performance.html">
            
                <a href="react-performance.html">
            
                    
                    优化 React 组件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="devtools.html">
            
                <a href="devtools.html">
            
                    
                    开发者工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="syntax.html">
            
                <a href="syntax.html">
            
                    
                    ES5 \/ ES6 \/ TypeScript 语法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="stateless-HMR.html">
            
                <a href="stateless-HMR.html">
            
                    
                    无状态组件和热加载
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                    实用方法
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../refguide/autorun-async.html">
            
                <a href="../refguide/autorun-async.html">
            
                    
                    autorunAsync
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../refguide/extending.html">
            
                <a href="../refguide/extending.html">
            
                    
                    Atom & Reaction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../refguide/create-transformer.html">
            
                <a href="../refguide/create-transformer.html">
            
                    
                    createTransformer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="../refguide/expr.html">
            
                <a href="../refguide/expr.html">
            
                    
                    expr
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="../refguide/extend-observable.html">
            
                <a href="../refguide/extend-observable.html">
            
                    
                    extendObservable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="../refguide/is-observable.html">
            
                <a href="../refguide/is-observable.html">
            
                    
                    isObservable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="../refguide/modifiers.html">
            
                <a href="../refguide/modifiers.html">
            
                    
                    modifiers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="../refguide/observe.html">
            
                <a href="../refguide/observe.html">
            
                    
                    intercept & observe
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9" data-path="../refguide/reaction.html">
            
                <a href="../refguide/reaction.html">
            
                    
                    reaction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10" data-path="../refguide/spy.html">
            
                <a href="../refguide/spy.html">
            
                    
                    spy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11" data-path="../refguide/tojson.html">
            
                <a href="../refguide/tojson.html">
            
                    
                    toJS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.12" data-path="../refguide/transaction.html">
            
                <a href="../refguide/transaction.html">
            
                    
                    transaction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13" data-path="../refguide/untracked.html">
            
                <a href="../refguide/untracked.html">
            
                    
                    untracked
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.14" data-path="../refguide/when.html">
            
                <a href="../refguide/when.html">
            
                    
                    when
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本書使用 GitBook 釋出
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >常见问题 & 最佳事件</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="common-pitfalls--best-practices">Common pitfalls &amp; best practices</h1>
<p>Stuck with MobX? This section contains a list of common issues people new to MobX might run into.</p>
<h4 id="arrayisarrayobservable123--false"><code>Array.isArray(observable([1,2,3])) === false</code></h4>
<p>In ES5 there is no way to reliably inherit from arrays, and hence observable arrays inherit from objects.
This means that regularly libraries are not able to recognize observable arrays as normal arrays (like lodash, or built-in operations like <code>Array.concat</code>).
This can simply be fixed by passing calling <code>observable.toJS()</code> or <code>observable.slice()</code> before passing the array to another library.
As long as the external library has no intent to modify the array, this will further work completely as expected.
You can use <code>isObservableArray(observable)</code> to check whether something is an observable array.</p>
<h4 id="objectsomenewprop--value-is-not-picked-up"><code>object.someNewProp = value</code> is not picked up</h4>
<p>MobX observable <em>objects</em> do not detect or react to property assignments that weren&apos;t declared observable before.
So MobX observable objects act as records with predefined keys.
You can use <code>extendObservable(target, props)</code> to introduce new observable properties to an object.
However object iterators like <code>for .. in</code> or <code>Object.keys()</code> won&apos;t react to this automatically.
If you need a dynamically keyed object, for example to store users by id, create observable _map_s using <code>asMap</code>.
More info on <a href="https://github.com/mobxjs/mobx/issues/219#issuecomment-220224813" target="_blank">asMap</a>.
For more info see <a href="react.html">what will MobX react to?</a>.</p>
<h3 id="use-observer-on-all-components-that-render-observables">Use <code>@observer</code> on all components that render <code>@observable</code>&apos;s.</h3>
<p><code>@observer</code> only enhances the component you are decorating, not the components used inside it.
So usually all your components should be decorated. Don&apos;t worry, this is not inefficient, in contrast, more <code>observer</code> components make rendering more efficient.</p>
<h3 id="dereference-values-as-lately-as-possible">Dereference values as lately as possible</h3>
<p>MobX can do a lot, but it cannot make primitive values observable (although it can wrap them in an object see <a href="../refguide/boxed.html">boxed observables</a>).
So it is not the <em>values</em> that are observable, but the <em>properties</em> of an object. This means that <code>@observer</code> actually reacts to the fact that you dereference a value.
So in our above example, the <code>Timer</code> component would <strong>not</strong> react if it was initialized as follows:</p>
<pre class="language-"><code class="lang-javascript">React<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Timer timerData<span class="token operator">=</span><span class="token punctuation">{</span>timerData<span class="token punctuation">.</span>secondsPassed<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
</code></pre>
<p>In this snippet just the current value of <code>secondsPassed</code> is passed to the <code>Timer</code>, which is the immutable value <code>0</code> (all primitives are immutable in JS).
That number won&apos;t change anymore in the future, so <code>Timer</code> will never update. It is the property <code>secondsPassed</code> that will change in the future,
so we need to access it <em>in</em> the component. Or in other words: always try to pass the owning object of an observable property.
For more info see <a href="react.html">what will MobX react to?</a>.</p>
<h4 id="computed-values-run-more-often-then-expected">Computed values run more often then expected</h4>
<p>If a computed property is <em>not</em> in use by some reaction (<code>autorun</code>, <code>observer</code> etc), computed expressions will be evaluated lazily; each time their value is requested (so they just act as normal property).
Computed values will only track their dependencies if they are observed.
This allows MobX to automatically suspend computations that are not actively in use.
See this <a href="https://medium.com/@mweststrate/becoming-fully-reactive-an-in-depth-explanation-of-mobservable-55995262a254" target="_blank">blog</a> or <a href="https://github.com/mobxjs/mobx/issues/356" target="_blank">issue #356</a> for an explanation.
So if you fiddle arounds, computed properties might not seem efficient. But when applied in a project that uses <code>observer</code>, <code>autorun</code> etc, they become very efficient.</p>
<p><em>N.B. in a next version of MobX computeds will automatically be kept alive during transactions as well, see PR: #452</em></p>
<h4 id="always-dispose-reactions">Always dispose reactions</h4>
<p>all forms of <code>autorun</code>, <code>observe</code> and <code>intercept</code> will only be garbage collected if all objects they observe are garbage collection themselves.
So it is recommend to use the disposer function that is returned from these methods to stop them when you no longer need them.
Usually for <code>observe</code> and <code>intercept</code> it is not strictly necessary to dispose them if when targed <code>this</code>.
For reactions like <code>autorun</code> it is more tricky, as they might observe many different observables, and as long as one of them is still in scope,
the reaction will remain in scope which means that all other observables it uses are also kept alive to support future recomputions.
So make sure to always dispose your reactions when you no longer need them!</p>
<p>Example:</p>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">const</span> VAT <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token number">1.20</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">OrderLIne</span> <span class="token punctuation">{</span>
    @observable price <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    @observable amount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// this autorun will be GC-ed together with the current orderline instance</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>handler <span class="token operator">=</span> <span class="token function">autorun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">doSomethingWith</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>amount<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true">// this autorun won&apos;t be GC-ed together with the current orderline instance</span>
        <span class="token comment" spellcheck="true">// since VAT keeps a reference to notify this autorun,</span>
        <span class="token comment" spellcheck="true">// which in turn keeps &apos;this&apos; in scope</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>handler <span class="token operator">=</span> <span class="token function">autorun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">doSomethingWith</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>amount <span class="token operator">*</span> VAT<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true">// So, to avoid subtle memory issues, always call..</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true">// When the reaction is no longer needed!</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="i-have-a-weird-exception-when-using-observable-in-a-react-component">I have a weird exception when using <code>@observable</code> in a React component.</h4>
<p>The following exception: <code>Uncaught TypeError: Cannot assign to read only property &apos;__mobxLazyInitializers&apos; of object</code> occurs when using a <code>react-hot-loader</code> that does not support decorators.
Either use <code>extendObservable</code> in <code>componentWillMount</code> instead of <code>@observable</code>, or upgrade to <code>react-hot-loader</code> <code>&quot;^3.0.0-beta.2&quot;</code> or higher.</p>
<h4 id="the-display-name-of-react-components-is-not-set">The display name of react components is not set</h4>
<p>If you use <code>export const MyComponent = observer((props =&gt; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>hi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>))</code>, no display name will be visible in the devtools.
The following approaches can be used to fix this:</p>
<pre class="language-"><code class="lang-javascript"><span class="token comment" spellcheck="true">// 1 (set displayName explicitly)</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> MyComponent <span class="token operator">=</span> <span class="token function">observer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>props <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>hi<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
myComponent<span class="token punctuation">.</span>displayName <span class="token operator">=</span> <span class="token string">&quot;MyComponent&quot;</span>

<span class="token comment" spellcheck="true">// 2 (MobX infers component name from function name)</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> MyComponent <span class="token operator">=</span> <span class="token function">observer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>hi<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// 3 (transpiler will infer component name from variable name)</span>
<span class="token keyword">const</span> _MyComponent <span class="token operator">=</span> <span class="token function">observer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>props <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>hi<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> MyComponent <span class="token operator">=</span> <span class="token function">observer</span><span class="token punctuation">(</span>_MyComponent<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// 4 (with default export)</span>
<span class="token keyword">const</span> MyComponent <span class="token operator">=</span> <span class="token function">observer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>props <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>hi<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">observer</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">)</span>
</code></pre>
<p>See also: <a href="http://mobxjs.github.io/mobx/best/stateless-HMR.html" target="_blank">http://mobxjs.github.io/mobx/best/stateless-HMR.html</a> or <a href="https://github.com/mobxjs/mobx/issues/141#issuecomment-228457886" target="_blank">#141</a>.</p>
<h4 id="the-proptype-of-an-observable-array-is-object">The propType of an observable array is object</h4>
<p>Observable arrays are actually objects, so they comply to <code>propTypes.object</code> instead of <code>array</code>.
<code>mobx-react</code> provides it&apos;s explicit <code>PropTypes</code> for observable data structures.</p>
<h4 id="rendering-listviews-in-react-native">Rendering ListViews in React Native</h4>
<p><code>ListView.DataSource</code> in React Native expects real arrays. Observable arrays are actually objects, make sure to <code>.slice()</code> them first before passing to list views. Furthermore, <code>ListView.DataSource</code> itself can be moved to the store and have it automatically updated with a <code>@computed</code>, this step can also be done on the component level.</p>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">class</span> <span class="token class-name">ListStore</span> <span class="token punctuation">{</span>
  @observable list <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">&apos;Hello World!&apos;</span><span class="token punctuation">,</span>
    <span class="token string">&apos;Hello React Native!&apos;</span><span class="token punctuation">,</span>
    <span class="token string">&apos;Hello MobX!&apos;</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>

  ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListView<span class="token punctuation">.</span>DataSource</span><span class="token punctuation">(</span><span class="token punctuation">{</span> rowHasChanged<span class="token punctuation">:</span> <span class="token punctuation">(</span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> r1 <span class="token operator">!==</span> r2 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  @computed <span class="token keyword">get</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ds<span class="token punctuation">.</span><span class="token function">cloneWithRows</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> listStore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

@observer <span class="token keyword">class</span> <span class="token class-name">List</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>ListView
        dataSource<span class="token operator">=</span><span class="token punctuation">{</span>listStore<span class="token punctuation">.</span>dataSource<span class="token punctuation">}</span>
        renderRow<span class="token operator">=</span><span class="token punctuation">{</span>row <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>Text<span class="token operator">&gt;</span><span class="token punctuation">{</span>row<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>Text<span class="token operator">&gt;</span><span class="token punctuation">}</span>
        enableEmptySections<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>For more info see <a href="https://github.com/mobxjs/mobx/issues/476" target="_blank">#476</a></p>
<h4 id="declaring-proptypes-might-cause-unnecessary-renders-in-dev-mode">Declaring propTypes might cause unnecessary renders in dev mode</h4>
<p>See: <a href="https://github.com/mobxjs/mobx-react/issues/56" target="_blank">https://github.com/mobxjs/mobx-react/issues/56</a></p>
<h4 id="observable-properties-initialize-lazily-when-using-babel"><code>@observable</code> properties initialize lazily when using Babel</h4>
<p>This issue only occurs when transpiling with Babel and not with Typescript (in which decorator support is more mature).
Observable properties will not be instantiated upon an instance until the first read / write to a property (at that point they all will be initialized).
This results in the following subtle bug:</p>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">class</span> <span class="token class-name">Todo</span> <span class="token punctuation">{</span>
    @observable done <span class="token operator">=</span> <span class="token boolean">true</span>
    @observable title <span class="token operator">=</span> <span class="token string">&quot;test&quot;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> todo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Todo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token string">&quot;done&quot;</span> <span class="token keyword">in</span> todo <span class="token comment" spellcheck="true">// true</span>
todo<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&quot;done&quot;</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// false</span>
Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// []</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>todo<span class="token punctuation">.</span>title<span class="token punctuation">)</span>
<span class="token string">&quot;done&quot;</span> <span class="token keyword">in</span> todo <span class="token comment" spellcheck="true">// true</span>
todo<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&quot;done&quot;</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// true</span>
Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// [&quot;done&quot;, &quot;title&quot;]</span>
</code></pre>
<p>In practice this is rarely an issue, only when using generic methods like <code>Object.assign(target, todo)</code> or <code>assert.deepEquals</code> <em>before</em> reading or writing any property of the object.
If you want to make sure that this issue doesn&apos;t occur, just initialize the fields in the constructor instead of at the field declaration or use <code>extendObservable</code> to create the observable properties.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../注意点--技巧.html" class="navigation navigation-prev " aria-label="Previous page: 注意点 & 技巧">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="store.html" class="navigation navigation-next " aria-label="Next page: 定义 stores">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"常见问题 & 最佳事件","level":"1.9.1","depth":2,"next":{"title":"定义 stores","level":"1.9.2","depth":2,"path":"best/store.md","ref":"best/store.md","articles":[]},"previous":{"title":"注意点 & 技巧","level":"1.9","depth":1,"path":"注意点--技巧.md","ref":"注意点--技巧.md","articles":[{"title":"常见问题 & 最佳事件","level":"1.9.1","depth":2,"path":"best/pitfalls.md","ref":"best/pitfalls.md","articles":[]},{"title":"定义 stores","level":"1.9.2","depth":2,"path":"best/store.md","ref":"best/store.md","articles":[]},{"title":"创建（异步）actions","level":"1.9.3","depth":2,"path":"best/actions.md","ref":"best/actions.md","articles":[]},{"title":"优化 React 组件","level":"1.9.4","depth":2,"path":"best/react-performance.md","ref":"best/react-performance.md","articles":[]},{"title":"开发者工具","level":"1.9.5","depth":2,"path":"best/devtools.md","ref":"best/devtools.md","articles":[]},{"title":"ES5 \\/ ES6 \\/ TypeScript 语法","level":"1.9.6","depth":2,"path":"best/syntax.md","ref":"best/syntax.md","articles":[]},{"title":"无状态组件和热加载","level":"1.9.7","depth":2,"path":"best/stateless-HMR.md","ref":"best/stateless-HMR.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["disqus","github","editlink","prism","-highlight","baidu","splitter","sitemap"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{},"disqus":{"useIdentifier":false,"shortName":"webpack-handbook"},"github":{"url":"https://github.com/ityiquan/ityiquan.github.com"},"editlink":{"label":"编辑本页","multilingual":false,"base":"https://github.com/ityiquan/ityiquan.github.com"},"splitter":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"sitemap":{"hostname":"http://zhaoda.net/"},"baidu":{"token":"a9787f0ab45d5e237bab522431d0a7ec"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"前端知识点总结","language":"zh","gitbook":"*","description":"前端知识点总结"},"file":{"path":"best/pitfalls.md","mtime":"2017-11-22T07:48:37.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2017-11-22T08:14:43.676Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-editlink/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-baidu/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

